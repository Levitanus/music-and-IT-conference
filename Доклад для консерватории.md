# На грани искусства и IT-индустрии: виртуальные музыкальные инструменты

Я буду считать своё выступление успешным, если мне удастся вдохновить вас чаще задумываться о том, чтобы оптимизировать свою работу, воспользоваться инструментами эволюционировавшей за последнее время IT-инфраструктуры в повседневной жизни, а особенно — крупных исследованиях и проектах.

В докладе использованы видео и аудиоматериалы разных авторов, а также есть несколько ссылок. Если вам интересны источники — я опубликовал текст доклада на [GitHub](https://github.com/Levitanus/music-and-IT-conference/blob/main/%D0%94%D0%BE%D0%BA%D0%BB%D0%B0%D0%B4%20%D0%B4%D0%BB%D1%8F%20%D0%BA%D0%BE%D0%BD%D1%81%D0%B5%D1%80%D0%B2%D0%B0%D1%82%D0%BE%D1%80%D0%B8%D0%B8.md), в конце презентации на него будет ссылка, а также вы можете написать мне.

Вообще айтишников от остальных людей отличает привычка к автоматизации. Им скучно делать одну и ту же вещь три раза. Так что, возможно, если вы прямо сейчас посмотрите на то, что делаете — и спросите, можно ли это автоматизировать (или, последние годы ещё очень модно → распределить: как торренты) — вам придёт неожиданно положительный ответ. Допустим, буквально пару недель назад меня точно также разбудила Надя Скворцова, которая в москве ведёт музыкальную терапию —

>Друг, нужно приложение, чтобы подключить электронное пианино к ноутбуку. На пианино ноту нажимаешь — а на весь экран рисуется нота, которую нажал. И чтобы ничего кроме.

Вот так вот спросонья я подписался на то, чтобы написать приложение. Еще несколько дней назад в этом месте была фраза о том, что я возьмусь за эту задачу после ближайших докладов и концертов. А сегодня это уже готовый [прототип](https://github.com/Levitanus/MyBigNote), который отправился в работу.

Если у вас также возникнет желание попросить помощи или коллаборации у знакомых или незнакомых специалистов — не откладывайте, пожалуйста это дело на завтра, на следующую неделю, даже на вечер: будет пересменка между докладами, или можно параллельно с моим выступлением подумать, какие специалисты вам нужны для проекта — и писать им, заражать своей идеей. Именно так и делаются большие и успешные проекты: сразу и на энтузиазме, пока никто не успел испугаться и отказаться.

Я собираюсь говорить о «виртуальных инструментах на основе сэмплирования». Звучит сложно, и часто встаёшь в тупик, пытаясь объяснить людям, что это такое и зачем нужно. Сегодня попробую описать то, чем мы занимаемся с помощью достаточно бородатого, но всё-таки достаточно точного анекдота:

### анекдот, две стороны задачи

Пианист заключает контракт с лейблом на запись всех рапсодий Листа. Приходит в назначенный час на студию, там продюсер, звукорежиссёр, ставят микрофоны, настраивают звук. Продюсер говорит: ну ты пока поиграй, а мы пойдём чайку попьём. И пианист разыгрывается: гаммы, арпеджио, репетиции, всё в прямом, расходящемся и т.п. Устал, выглядывает в операторскую, навстречу продюсер:

— ну молодец, приятно было поработать!

— Так я ж только разыгрался?

— Ну и отлично! А дальше мы нарежем.

Ситуация абсурдная, но мы работаем над тем, чтобы она стала реальной. Если представить, что это не анекдот, а реальная история, то у нас возникнут два закономерных вопроса:

- что такого там наиграл пианист, что из этого можно было нарезать все рапсодии Листа?
- как так хи́тро там всё нарезали звукорежиссёр с продюсером, что им это оказалось легче, чем писать вживую?

Не могу сказать, что это очень молодая сфера деятельности. Можно брать разные точки отсчёта, но, пожалуй, ближе к концу 90-х сэмплы уже всерьёз пытались выполнять работу живых музыкантов.

Многие музыканты на подобные амбиции возражают: вы что, всерьёз думаете, что машина сможет заменить высококлассного исполнителя?! И да и нет:

Я, будучи оркестровщиком и пианистом с концертной практикой — всё-таки техно-оптимист. Я верю в то, что технологии убирают из нашей профессии всю скуку и освобождают время для задач более высокого уровня. Мне нравится, что когда я программирую — текстовый редактор дописывает за меня слова, проверяет правописание, показывает — как я писал это же сложное имя где-то в другом файле в соседней папке. Точно также мне нравится, что компилятор за меня пишет очень много скучного кода, позволяя выражать свои мысли в нескольких строчках, которые действительно необходимы. Да, я занимаюсь оркестровкой 15 лет и для меня не составляет труда по одному голосу с первого раза сыграть законченный период в четырёхголосном складе, но я не вижу причин, почему нотный редактор не должен подчёркивать параллельные квинты, или дописывать проведение темы в фуге, или делать заготовку для тонального ответа.
С другой стороны — действительно хороший высоко оплачиваемый исполнитель, по крайней мере, на данный момент, и, думаю, ещё на несколько десятилетий вперёд будет играть дешевле быстрее и лучше, чем машина. Зато машина может уже сейчас сыграть дёшево и плохо — тем самым освободив исполнителя от той, прямо скажем, халтуры, которая ему только портит жизнь.

[источник: orchestra hit](https://youtu.be/8A1Aj1_EF9Y)

И мне бы хотелось ещё раз показать механизм, с которым сэмплы заменяют музыкантов. Мне очень понравился рассказ о том, как в поп-музыке укоренился звук под названием «orchestra hit», и как тесно он связан с первым цифровым сэмплером — «Fairlight CMI». «Orchestra hit» — это первый аккорд из „поганого пляса кощеева царства“ Стравинского. Его записали с пластинки, и стали играть с клавиатуры. И, таким образом, в электронной и поп-музыке появился эпичный настоящий оркестровый звук, ради которого не пришлось собирать на сцене много хороших музыкантов, чтобы они «похалтурили» ([фрагмент](orchestra_hit.mp4)). Так, потихоньку: по одной ноте, по одной фразе, сэмплы много лет избавляют музыкантов от халтуры и экономят деньги малобюджетных проектов.

Кроме того, не стоит недооценивать ценность сэмплов для образования: сложно переоценить, как ценно услышать свой оркестровый опус в более или менее приближенном исполнении, и как трудно донести свои сочинения до живого оркестра, даже будучи студентом ВУЗа. Да и высокобюджетные фильмы и музыкальные проекты не чураются сэмплов как дополнительных красок, средства для замазывания огрехов записи и уплотнения звука.

### прогресс

Когда я стал плотно заниматься всей этой виртуальной кухней (где-то середина нулевых) — сэмплированный оркестр звучал примерно так [Корнелюк — МиМ 2005](Korneluk_Voland_2005.mp3)

Уже через пять лет человек-легенда Blakus завёл каналы на [soundcloud](https://soundcloud.com/blakus-mfm) и [YouTube](https://www.youtube.com/watch?v=vDQHqf2NYmU), вот его мокап на тему из Гарри Поттера \([клац](Blakus_Hedwigs_Theme_2011.mp3)\).

А вот современное состояние: тот же блакус образца 2020 года: \([клац](Blakus_Star_Wars_Main_Title_2020.mp4)\).

И, если кто-то успел подумать, что виртуальный оркестр пришёл к совершенству — давайте ещё посмотрим [**фрагмент сравнения живого исполнения с мокапом**](MockUp_VS_Live_Orchestra.mp4) *([оригинал](https://www.youtube.com/watch?v=Es0zvyAmB7w))*.

Сейчас при сэмплировании используют теорию исполнительства, наработанную к настоящему времени: в моём первом проекте настольной книжкой были таблицы Мальтера, сейчас бы я уже смотрел на что-нибудь вроде книги [«behind the bars»](http://www.behindbarsnotation.co.uk/) — полное руководство по нотации Элайны Гульд, так как она лучше отражает современный композиторский и исполнительский тезаурус. Однако мы подошли вплотную к границе теории исполнительского искусства, которую можно сформулировать как алгоритм и использовать для виртуальных инструментов — и дальше надо изобретать что-то ещё. Если говорить откровенно, мы пока не берёмся даже отличить деташе из «темы Монтекки и Капулетти» Прокофьева и деташе из «маленькой ночной серенады» Моцарта. И я всё-таки вижу перспективу новых работ по исполнительскому мастерству, которые родились в ходе разработки новых поколений виртуальных инструментов. Сэмплы больше решают вопросы того «что должен сыграть исполнитель», чтобы потенциально можно было «нарезать рапсодии Листа», в то время, как виртуальные инструменты на основе физического моделирования страдают обратной проблемой — отсутствия инструментов аутентичного исполнения на них, и с этой стороны задачи: «найти алгоритм хорошего исполнения» также работают несколько компаний.

## история успеха

Конечно, если хочешь вдохновить кого-то на большую работу, хорошо бы иметь на руках историю успеха. И, к счастью, она у меня есть.

### студенческий проект и результат на текущий момент

„6 лет тому назад, пришлось мне сделать вынужденную посадку в Сахаре...“ [муз пример](добрый_жук.mp3)

Не совсем: я задумал сделать виртуальный оркестр русских народных инструментов. По тем временам для России проект уникальный, так как у нас в стране разработчиков было по пальцам сосчитать, а с оркестрами не работал вообще никто. Сейчас, несмотря на большой срок, это до сих пор единственный вменяемый оркестр, сделанный (ну ещё не до конца) в России. Хотя некоторые ребята уже, как минимум, собирают большие составы и записывают с ними разные текстуры.

Вот так эти инструменты сейчас [звучат](добрый_жук_naked.mp3) без всех остальных: мы это называем «голые».

### что удалось, чем пришлось пожертвовать

Первым камнем преткновения были деньги: начал с безуспешной попытки найти финансирование в консерватории и областном министерстве культуры, потом чуть более успешно попробовал краудфандинг, хотя boomstarter по окончании кампании оставил не очень приятные впечатления, а в итоге деньги на оркестр выделил папа моей бывшей ученицы — Андрей Кочев.

Бюджет у нас был, прямо скажем, тика-в-тику, даже по тем временам: ребятам я платил 500₽ в час, Юрий Иосифович Исаков тоже с нами был за номинальные деньги. Так что набор сэмплов получился максимально скромным: я держал ориентир на, достаточно старую даже по тем временам библиотеку струнных LASS. Старую, тем не менее, уважаемую.

Так что по штрихам и исполнительским возможностям получилось сделать оркестр уровня достаточного, чтобы «создать впечатление оркестрового звука», но достаточно бедный на техники исполнения. Тем не менее всё, что мы записали, с точки зрения исполнения — записали крайне удачно. Всего получается 4 артикуляции на инструмент (если не считать аккорды у группы балалаек), которые, за счёт сухого звука достаточно мобильны и замечательно обрабатываются в реальном времени.

Если честно —  я удивлён. Удивлён тем, что фактически на студенческом энтузиазме силами однокурсников удалось сделать проект, который звучит и будет продолжать появляться в русских фонограммах. Да, спустя 6 лет у меня ещё готовы не все инструменты, но примерно половина состава уже доступна в сети, а оставшуюся работу я надеюсь закончить в этом году. 

### побочные продукты производства

Еще мне кажется важным такой момент: поскольку я весь пост-продакшн делаю в одиночку, — многие попытки немного облегчить себе жизнь выливались в какой-то pet-проект. Так я написал компилятор для языка *KSP*; внёс большой вклад и продолжаю контрибьютить в библиотеку *reapy*; было несколько разной степени удачливости попыток написания комбайна для нарезки сэмплов, последняя попытка была этой зимой под новый год, и я ей в целом очень доволен.

Таким образом, в процессе работы над «основным» проектом появилось несколько инструментов, которые лежат в открытом доступе и ими пользуются другие разработчики. Мне кажется очень важным, что таким образом наполняется мир открытого софта.

### рост индустрии за время жизни проекта

Хотел бы также отметить насколько наша индустрия повзрослела за те шесть лет, что я занимаюсь этими народными. У нас появились новые чудесные инструменты стандартизации исполнительского интерфейса: мы их называем expression maps, несмотря на то, что это имя собственное, примерно такое же как Xerox. Наши сэмплеры обросли новыми возможностями, в том числе получили развитие инструменты MIR — Music information retrieval. Появился, наконец, свободный полноценный сэмплер с уровнем входа не выше, чем KONTAKT! Так что я всех, кто как-то этим занимается, агитирую переходить на HISE. И очень я надеюсь, что в нашем мире всё больше будет открытой информации и свободного софта.

### о поколениях технологий сэмплирования

Собственно, сейчас этот проект с народными струнными можно назвать предыдущим поколением технологий сэмплирования. Фактически, это записанные таблицы Мальтера по инструментоведению:

- взяли нотку ми, сыграли p, mf, f, ff
- взяли нотку фа, сыграли p, mf, f, ff
- сыграли легато от ми к фа и от фа к ми

Этим занимались примерно до середины 10-х годов. И у такой методики есть достоинства в дешевизне и предсказуемости. Если правильно записать — их легко обрабатывать, нарезать и микшировать в реальном времени. Но и есть множество недостатков, начиная от плохого поведения сэмплов, записанных в зале, заканчивая тем, что музыкантам на сессии записи смертельно скучно, что также плохо сказывается и на качестве их работы.

Поэтому, современное поколение инструментов пытаются делать, используя на записи нечто вроде музыкальных произведений, которые можно музыкально исполнять. Таким образом, получается перейти от категорий количественных: насколько пиано вы сыграли, или насколько сильно стукнули пальцем при легато к категориям стилистическим: в каком характере играют эти флейты?

В итоге достоинства текущего поколения библиотек обладают недостатками как раз там, где предыдущее поколение блистало: они не универсальны, громоздки, их очень дорого резать.

И, несмотря на то, что это поколение будет ещё с нами лет десять, и ему есть куда развиваться, я уже не вижу смысла ввязываться в эту работу. Мне кажется, следующее поколение сэмплированных инструментов откажется от попытки реагировать на исполнение в реальном времени и перейдёт к оффлайн-рендеру. Условно, вместо «игровой графики» которая оптимизирована настолько, чтобы на топовых видеокартах получалось 120 кадров в секунду — появится человеческий рендер одного кадра в несколько десятков секунд. Таким образом мы решим сразу ряд проблем и получим воз новых возможностей:

- сейчас инструмент ничего не знает о «планах» MIDI-музыканта на ближайшие 2-3 секунды, в то время, как музыкант-исполнитель на акустическом инструменте уже за 1-2 секунды готовит свой аппарат, фразу, тембр своего инструмента к приближающейся музыкальной мысли. Оффлайн даст эту самую информацию, которую можно использовать.
- можно было бы оперировать гораздо большим количеством сэмплов так как не надо упираться в ограничения реального времени.
- и в то же время отказаться от вынужденных оптимизаций для «отзывчивого управления» инструментом. Сейчас очень сложно, либо очень ненатурально реализуется крещендо, переход с вибрато на нон-вибрато, одним словом — всё, чем характерна живая игра.

Последний год я знакомился с кухней анализа аудио, и сейчас потихоньку думаю двигаться к реализации прототипа такого оффлайн-сэмплера.

Моя идея в том, чтобы собирать, скажем так, метаданные, как с MIDI-дорожки, того, что наиграл композитор в компьютер, так и с сэмплов — того, что записано музыкантами, и подбирать максимально подходящие фрагменты, а также максимально хорошие моменты склейки всех подобранных кусочков. Обе эти задачи в нашем современном рабочем процессе — неразрешимы.

Однако, это совершенно меняет парадигму записи сэмплов — запись должна продолжать принципы заложенные разработчиками самых последних инструментов. Фактически, вместо условного «Ганона», или «Шрадика»: одним словом — упражнений, мы должны записывать высококлассную музыку, в то же время, отвечающую инженерным запросам. Проще говоря, надо как-то формализовать и оформить в серии оркестровых опусов наш музыкальный тезаурус. Своеобразный Хорошо Темперированный Клавир, Хроматическая фантазия и фуга и все этюды Черни вместе взятые.

И это — огромная работа, которой я грежу. Её в принципе можно грызть по кусочкам, чем я в свободное время и занимаюсь: потихоньку учусь в тепличных условиях автоматически резать и склеивать сэмплы там, где надо. Потом попробую сделать ядро оффлайн-сэмплера и на нём уже с живыми музыкантами разбираться, как всё должно работать, записываться и развиваться.

## заключение

Я очень надеюсь, что у кого-то из вас появились новые идеи относительно потенциальной коллаборации с IT-шниками. Ещё больше надеюсь, что кто-то вдохновился всей нашей оркестровой кухней, и займётся нашей работой. Конечно, всегда есть желание что-то сделать первым, но на самом деле, не меньше радости испытываешь, когда большое сообщество работает над решением твоих повседневных рабочих проблем, и, более того, решает их.

Да и вообще, что касается музыкального IT в России — нам сейчас нужно создать среду, в которой такие музыкально-инженерные проекты могли бы существовать: если сейчас инициатива от студентов часто заканчивается некоторой «подпольной» деятельностью — то хотелось бы, чтобы хотя бы на уровне научного руководителя при работе над темой или даже при формулировании темы возникал бы вопрос: есть ли тут возможность привлечь программиста и сделать гораздо вкуснее? Единственное, предостережение, которое я бы хотел сделать — говорите с вашими IT-специалистами понятно. Даже если это человек-оркестр у которого горят глаза, он осознаёт масштаб и цель работы, он способен помочь, но скажешь ему что-то вроде банального «квартсекстаккорда» — и он выпадает в синий экран. То же пожелание у меня к дорогим айтишникам — будьте аккуратнее в обсуждениях того, массив надо использовать или вектор, или какое в алгоритме получится «большое O». Это всё, равно как и квартсекстаккорды — важная часть вашего общего проекта, но в голове у вашего партнёра мыслей о них должно быть не больше, чем требуется))

Конечно, хочется быть на острие прогресса, и я надеюсь, что и я сам ещё внесу свой вклад в развитие нашей индустрии. Спасибо за внимание!
