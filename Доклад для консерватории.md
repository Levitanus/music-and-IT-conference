# На грани искусства и IT-индустрии: виртуальные музыкальные инструменты

Я буду считать своё выступление успешным, если мне удастся вдохновить вас чаще задумываться об автоматизации своей деятельности, использовать инструменты выросшей за последнее время IT-инфраструктуры в повседневной жизни, а особенно — крупных исследованиях и проектах.

Вообще айтишников от остальных людей отличает привычка к автоматизации. Им скучно делать одну и ту же вещь три раза. Так что, возможно, если вы прямо сейчас посмотрите на то, что делаете — и спросите, можно ли это автоматизировать (или, последние годы ещё очень модно → распределить: как торренты) — вам придёт неожиданно положительный ответ. Допустим, буквально пару недель назад меня точно также разбудила Надя Скворцова, которая в москве ведёт музыкальную терапию — 

>«Друг, надо приложение, чтобы на электронном пианине ноту нажимаешь — а эта нота показывалась на весь экран ноутбука, к которому эта пианина подключена. И чтобы ничего кроме». Вот так вот спросонья я подписался на то, чтобы написать приложуху, сейчас все концерты и доклады пройдут — и напишу))

Я собираюсь говорить о «виртуальных инструментах на основе сэмплирования». Звучит сложно, и часто встаёшь в тупик, пытаясь объяснить людям, что это такое и зачем нужно. Сегодня попробую описать то, чем мы занимаемся с помощью достаточно бородатого, но всё-таки достаточно точного анекдота:

### анекдот, две стороны задачи

Пианист заключает контракт с лейблом на запись всех рапсодий Листа. Приходит в назначенный час на студию, там продюсер, звукорежиссёр, ставят микрофоны, настраивают звук. Продюсер говорит: ну ты пока поиграй, а мы пойдём чайку попьём. И пианист разыгрывается: гаммы, арпеджио, репетиции, всё в прямом, расходящемся и т.п. Устал, выглядывает в операторскую, навстречу продюсер:

— ну молодец, приятно было поработать!

— Так я ж только разыгрался?

— Ну и отлично! А дальше мы нарежем.

Ситуация абсурдная, но мы работаем над тем, чтобы она стала реальной. Если представить, что это не анекдот, а реальная история, то у нас возникнут два закономерных вопроса:

- что такого там наиграл пианист, что из этого можно было нарезать все рапсодии Листа?
- как так хитро там всё нарезали звукорежиссёр с продюсером, что им это оказалось легче, чем писать вживую?

Не могу сказать, что это очень молодая сфера деятельности. Можно брать разные точки отсчёта, но, пожалуй, ближе к концу 90-х сэмплы уже всерьёз пытались выполнять работу живых музыкантов.

### прогресс

Когда я стал плотно заниматься всей этой виртуальной кухней (где-то середина нулевых) — сэмплированный оркестр звучал примерно так [Корнелюк — МиМ 2005](Korneluk_Voland_2005.mp3)

Уже через пять лет человек-легенда Blakus завёл каналы на [soundcloud](https://soundcloud.com/blakus-mfm) и [YouTube](https://www.youtube.com/watch?v=vDQHqf2NYmU), вот его мокап на тему из Гарри Поттера \([клац](Blakus_Hedwigs_Theme_2011.mp3)\).

А вот современное состояние: тот же блакус образца 2020 года: \([клац](Blakus_Star_Wars_Main_Title_2020.mp4)\).

И, если кто-то успел подумать, что виртуальный оркестр пришёл к совершенству — давайте ещё посмотрим [**фрагмент сравнения живого исполнения с мокапом**](MockUp_VS_Live_Orchestra.mp4) *([оригинал](https://www.youtube.com/watch?v=Es0zvyAmB7w))*. [TODO]

Сейчас при сэмплировании используют теорию исполнительства, наработанную к настоящему времени: в моём первом проекте настольной книжкой были таблицы Мальтера, сейчас бы я уже смотрел на что-нибудь вроде книги [«behind the bars»](http://www.behindbarsnotation.co.uk/) — полное руководство по нотации Элайны Гульд, так как она лучше отражает современный композиторский и исполнительский тезаурус. Однако мы подошли вплотную к краю теоретической исполнительской мысли — и дальше надо изобретать что-то ещё. Если говорить откровенно, мы пока не берёмся даже отличить деташе из «темы Монтеки и Капулетти» Прокофьева и деташе из «маленькой ночной серенады» Моцарта.

## история успеха

Конечно, если хочешь вдохновить кого-то на большую работу, хорошо бы иметь на руках историю успеха. И, к счастью, она у меня есть.

### студенческий проект и результат на текущий момент

6 лет тому назад, пришлось мне сделать вынужденную посадку в Сахаре... [муз пример](добрый_жук.mp3)

Не совсем: я задумал сделать виртуальный оркестр русских народных инструментов. По тем временам для России проект уникальный, так как у нас в стране разработчиков было по пальцам сосчитать, а с оркестрами не работал вообще никто. Сейчас, несмотря на большой срок, это до сих пор единственный вменяемый оркестр, сделанный (ну ещё не до конца) в России. Хотя некоторые ребята уже, как минимум, собирают большие составы и записывают с ними разные текстуры.

Вот так эти инструменты сейчас [звучат](добрый_жук_naked.mp3) без всех остальных: мы это называем «голые».

### что удалось, чем пришлось пожертвовать

Первым камнем преткновения были деньги: сначала пытался влезть в какой-нибудь грант, потом чуть более успешно попробовал краудфандинг, хотя boomstarter по окончании кампании оставил не очень приятные впечатления, а в итоге деньги на оркестр выделил папа моей бывшей ученицы — Андрей Кочев.

Бюджет у нас был, прямо скажем, тика-в-тику, даже по тем временам: ребятам я платил 500₽ в час, Юрий Иосифович Исаков тоже с нами был за номинальные деньги. Так что набор сэмплов получился максимально скромным: я держал ориентир на, достаточно старую даже по тем временам библиотеку струнных LASS. Старую, тем не менее, уважаемую.

Так что по штрихам и исполнительским возможностям получилось сделать оркестр уровня достаточного, чтобы «создать впечатление оркестрового звука», но без кучи исполнительских приёмов, вроде флажолет или щипков пальцами у домр. Тем не менее всё, что мы записали, с точки зрения исполнения — записали крайне удачно. Всего получается 4 артикуляции на инструмент (если не считать аккорды у группы балалаек), которые, за счёт сухого звука достаточно мобильны и замечательно обрабатываются в реальном времени.

В общем, я удивлён. Планы, конечно, были гораздо более Наполеоновские, но я удивлён, что фактически на студенческом энтузиазме удалось вывезти проект, который звучит и будет продолжать появляться в русских фонограммах. И очень надеюсь в этом году выпустить в релиз полную версию оркестра, для этого наконец есть все условия.

### побочные продукты производства

Вообще, когда делаешь что-то в одиночку без свободного времени и средств на негров — пытаешься заниматься оптимизацией везде где только можно.

Поскольку, надо мной не стоял ни научрук с зачёткой, ни инвестор с паяльником, я себе позволил потратить времени на «оптимизацию» *больше*, чем на сам проект. Неоднократно попытка немного облегчить себе жизнь выливалась в какой-то pet-проект. Так я написал компилятор для языка KSP; внёс большой вклад и продолжаю контрибьютить в библиотеку reapy; было несколько разной степени удачливости попыток написания комбайна для нарезки сэмплов, последняя попытка была этой зимой под новый год, и я ей в целом очень доволен.

И всё это так или иначе наполняет мир открытого софта новыми инструментами, которые созданы так или иначе в рамках работы над «основным» проектом.

### рост индустрии за время жизни проекта

Напоследок хотел бы отметить насколько наша индустрия повзрослела за те шесть лет, что я занимаюсь этими народными. У нас появились новые чудесные инструменты стандартизации исполнительского интерфейса: мы их называем expression maps, несмотря на то, что это имя собственное, примерно такое же как Xerox. Наши сэмплеры обросли новыми возможностями, в том числе получили развитие инструменты MIR — Music information retrieval. Появился, наконец, свободный полноценный сэмплер с уровнем входа не выше, чем KONTAKT! Так что я всех, кто как-то этим занимается, агитирую переходить на HISE. И очень я надеюсь, что в нашем мире всё больше будет открытой информации и свободного софта.

### о поколениях технологий сэмплирования

Собственно, сейчас этот проект с народными струнными можно назвать предыдущим поколением технологий сэмплирования. Фактически, это записанные таблицы Мальтера по инструментоведению:

- взяли нотку ми, сыграли p, mf, f, ff
- взяли нотку фа, сыграли p, mf, f, ff
- сыграли легато от ми к фа и от фа к ми

Этим занимались примерно до середины 10-х годов. И у такой методики есть достоинства в дешевизне и предсказуемости. Если правильно записать — их легко обрабатывать, нарезать и микшировать в реальном времени. Но и есть гора недостатков, начиная от плохого поведения сэмплов, записанных в зале, заканчивая тем, что музыкантов на сессии записи посещает скука смертная.

Поэтому, современное поколение инструментов пытаются делать, используя на записи нечто вроде музыкальных произведений, которые можно музыкально исполнять. Таким образом, получается перейти от категорий количественных: насколько пиано вы сыграли, или насколько сильно стукнули пальцем при легато к категориям стилистическим: в каком характере играют эти флейты?

В итоге достоинства текущего поколения библиотек обладают недостатками как раз там, где предыдущее поколение блистало: они не универсальны, громоздки, их очень дорого резать.

И, несмотря на то, что это поколение будет ещё с нами лет десять, и ему есть куда развиваться, я уже не вижу смысла ввязываться в эту работу. Мне кажется, следующее поколение сэмплированных инструментов откажется от попытки реагировать на исполнение в реальном времени и перейдёт к оффлайн-рендеру. Условно, вместо «игровой графики» которая оптимизирована настолько, чтобы на топовых видеокартах получалось 120 кадров в секунду — появится человеческий рендер одного кадра в несколько десятков секунд. Таким образом мы решим сразу ряд проблем и получим воз новых возможностей:

- сейчас инструмент ничего не знает о «планах» MIDI-музыканта на ближайшие 2-3 секунды, в то время, как музыкант-исполнитель на акустическом инструменте уже за 1-2 секунды готовит свой аппарат, фразу, тембр своего инструмента к приближающейся музыкальной мысли. Оффлайн даст эту самую информацию, которую можно использовать.
- можно было бы оперировать гораздо большим количеством сэмплов так как не надо упираться в ограничения реального времени.
- и в то же время отказаться от вынужденных оптимизаций для «отзывчивого управления» инструментом. Сейчас очень сложно, либо очень ненатурально реализуется крещендо, переход с вибрато на нон-вибрато, одним словом — всё, чем характерна живая игра.

Последний год я знакомился с кухней анализа аудио, и сейчас потихоньку думаю двигаться к реализации прототипа такого оффлайн-сэмплера.

Моя идея в том, чтобы собирать, скажем так, метаданные, как с MIDI-дорожки, того, что наиграл композитор в компьютер, так и с сэмплов — того, что записано музыкантами, и подбирать максимально подходящие фрагменты, а также максимально хорошие моменты склейки всех подобранных кусочков. Обе эти задачи в нашем современном рабочем процессе — неразрешимы.

Однако, это совершенно меняет парадигму записи сэмплов — запись должна продолжать принципы заложенные разработчиками самых последних инструментов. Фактически, вместо условного «Ганона», или «Шрадика» (это такие упражнения для развития техники пианистов и скрипачей) мы должны записывать высококлассную музыку, в то же время, отвечающую инженерным запросам. Проще говоря, надо как-то формализовать и оформить в серии оркестровых опусов наш музыкальный тезаурус. Своеобразный Хорошо Темперированный Клавир, Хроматическая фантазия и фуга и все этюды Черни вместе взятые.

И это — огромная работа, которой я грежу. Её в принципе можно грызть по кусочкам, чем я в свободное время и занимаюсь: потихоньку учусь в тепличных условиях автоматически резать и склеивать сэмплы там, где надо. Потом попробую сделать ядро оффлайн-сэмплера и на нём уже с живыми музыкантами разбираться, как всё должно работать, записываться и развиваться.

## заключение

Я очень надеюсь, что у кого-то из вас появились новые идеи относительно потенциальной коллаборации с IT-шниками. Ещё больше надеюсь, что кто-то вдохновился всей нашей оркестровой кухней, и впряжётся в нашу работу. Конечно, всегда есть желание что-то сделать первым, но на самом деле, не меньше радости испытываешь, когда большое сообщество работает над решением твоих повседневных рабочих проблем, и, более того, решает их.

Да и вообще, что касается музыкального IT в России — нам сейчас нужно срочно осознать эту дыру и создать среду, в которой такие музыкально-инженерные проекты могли бы существовать: если сейчас инициатива от студентов часто заканчивается некоторой «подпольной» деятельностью — то хотелось бы, чтобы хотя бы на уровне научного руководителя при работе над темой или даже при формулировании темы возникал бы вопрос: есть ли тут возможность привлечь программиста и сделать гораздо вкуснее? Единственное, предостережение, которое я бы хотел сделать — говорите с вашими IT-специалистами понятно. Даже если это человек-оркестр, вроде тех людей, что играют эти дни на сценах фестиваля. Бывает, у человека горят глаза, он осознаёт масштаб и цель твоей работы, он способен тебе помочь, но скажешь ему что-то вроде банального «квартсекстаккорда» — и он выпадает в синий экран. То же пожелание у меня к дорогим айтишникам — будьте аккуратнее в обсуждениях того, массив надо использовать или вектор, или какое в алгоритме получится «большое O». Это всё, равно как и квартсекстаккорды — важная часть вашего общего проекта, но в голове у вашего партнёра мыслей о них должно быть не больше, чем требуется))

Конечно, хочется быть на острие прогресса, и я надеюсь, что и я сам ещё внесу свой вклад в развитие нашей индустрии. Спасибо за внимание!
